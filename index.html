<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>IntercomX Ultra Dashboard</title>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body {
    margin:0;
    font-family: Arial, sans-serif;
    background: linear-gradient(135deg,#0f2027,#203a43,#2c5364);
    color:white;
    overflow-x:hidden;
}

.bg-chart {
    position:fixed;
    top:0;
    left:0;
    width:100%;
    height:100%;
    opacity:0.08;
    z-index:0;
}

.container {
    position:relative;
    z-index:2;
    padding:30px;
}

.card {
    background: rgba(255,255,255,0.05);
    backdrop-filter: blur(12px);
    border-radius:20px;
    padding:20px;
    margin:20px 0;
}

input {
    padding:10px;
    border-radius:10px;
    border:none;
    width:200px;
}

button {
    padding:10px 15px;
    border:none;
    border-radius:10px;
    background:#00c6ff;
    cursor:pointer;
    font-weight:bold;
}
.green { color:#00ff99; }
.red { color:#ff4d6d; }

.trending-item {
    margin:5px 0;
}
</style>
</head>
<body>

<canvas id="bgChart" class="bg-chart"></canvas>

<div class="container">

<h1>ðŸš€ IntercomX ULTRA Dashboard</h1>

<div class="card">
<h2>ðŸ”Ž Token Search (All Coins)</h2>
<input id="tokenInput" placeholder="Enter ticker (ETH)" />
<button onclick="searchByTicker()">Search</button>

<h3 id="tokenName"></h3>
<p>Price: <span id="price">-</span></p>
<p>24h Change: <span id="change">-</span></p>
</div>

<div class="card">
<h2>â›½ Ethereum Gas</h2>
<p>Low: <span id="gasLow">-</span> Gwei</p>
<p>Average: <span id="gasAvg">-</span> Gwei</p>
<p>High: <span id="gasHigh">-</span> Gwei</p>
</div>

<div class="card">
<h2>ðŸ”¥ Trending Coins</h2>
<div id="trending"></div>
</div>

</div>

<script>
let coinList = []

// ---------- LOAD COIN LIST WITH CACHE ----------
async function loadCoinList() {
    const cache = localStorage.getItem("coinList")
    if (cache) {
        coinList = JSON.parse(cache)
        return
    }

    const res = await fetch("https://api.coingecko.com/api/v3/coins/list")
    coinList = await res.json()
    localStorage.setItem("coinList", JSON.stringify(coinList))
}

// ---------- SEARCH TOKEN ----------
async function searchByTicker() {
    const ticker = document.getElementById("tokenInput").value.toLowerCase()
    const matches = coinList.filter(c => c.symbol === ticker)

    if(matches.length === 0){
        alert("Token not found")
        return
    }

    fetchTokenData(matches[0].id)
}

async function fetchTokenData(id){
    const res = await fetch(
        `https://api.coingecko.com/api/v3/coins/markets?vs_currency=usd&ids=${id}`
    )
    const data = await res.json()
    const coin = data[0]

    document.getElementById("tokenName").innerText = coin.name
    document.getElementById("price").innerText = "$"+coin.current_price

    const changeEl = document.getElementById("change")
    changeEl.innerText = coin.price_change_percentage_24h+"%"
    changeEl.className = coin.price_change_percentage_24h >= 0 ? "green" : "red"

    updateBackgroundChart(id)
}

// ---------- GAS TRACKER ----------
async function loadGas(){
    const res = await fetch("https://api.etherscan.io/api?module=gastracker&action=gasoracle")
    const data = await res.json()
    document.getElementById("gasLow").innerText = data.result.SafeGasPrice
    document.getElementById("gasAvg").innerText = data.result.ProposeGasPrice
    document.getElementById("gasHigh").innerText = data.result.FastGasPrice
}

// ---------- TRENDING ----------
async function loadTrending(){
    const res = await fetch("https://api.coingecko.com/api/v3/search/trending")
    const data = await res.json()
    const div = document.getElementById("trending")
    div.innerHTML=""
    data.coins.forEach(c=>{
        div.innerHTML += `<div class="trending-item">${c.item.name} (${c.item.symbol})</div>`
    })
}

// ---------- BACKGROUND CHART ----------
let bgChart
async function updateBackgroundChart(id){
    const res = await fetch(
        `https://api.coingecko.com/api/v3/coins/${id}/market_chart?vs_currency=usd&days=1`
    )
    const data = await res.json()
    const prices = data.prices.map(p=>p[1])

    const ctx = document.getElementById("bgChart").getContext("2d")

    if(bgChart) bgChart.destroy()

    bgChart = new Chart(ctx,{
        type:"line",
        data:{
            labels:prices.map(()=> ""),
            datasets:[{
                data:prices,
                borderWidth:1,
                fill:false
            }]
        },
        options:{
            plugins:{legend:{display:false}},
            scales:{
                x:{display:false},
                y:{display:false}
            }
        }
    })
}

// ---------- INIT ----------
loadCoinList()
loadGas()
loadTrending()

setInterval(loadGas,30000)
setInterval(loadTrending,60000)
</script>

</body>
</html>
