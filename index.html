<!DOCTYPE html>
<html>
<head>
  <title>IntercomX Real Web3 AI</title>
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.min.js"></script>
  <style>
    body { background:#0f172a; color:white; font-family:Arial; text-align:center; }
    .box { background:#1e293b; padding:20px; margin:20px auto; width:400px; border-radius:10px; }
    input, button { padding:10px; margin:5px; width:80%; border-radius:5px; border:none; }
    button { background:#38bdf8; font-weight:bold; cursor:pointer; }
  </style>
</head>
<body>

<h1>IntercomX ðŸš€ Real Web3 AI</h1>

<div class="box">
  <button onclick="connectWallet()">Connect MetaMask</button>
  <p id="wallet"></p>
  <button onclick="getBalance()">Check Balance</button>
</div>

<div class="box">
  <h3>Swap ETH â†’ USDC (Uniswap)</h3>
  <input id="amount" placeholder="Amount in ETH">
  <button onclick="swap()">Swap Now</button>
</div>

<div class="box">
  <h3>AI Command</h3>
  <input id="aiInput" placeholder="swap 0.01 eth">
  <button onclick="runAI()">Run AI</button>
</div>

<div class="box">
  <div id="output"></div>
</div>

<script>
let provider;
let signer;
let userAddress;

const UNISWAP_ROUTER = "0xE592427A0AEce92De3Edee1F18E0157C05861564"; // V3 Router
const USDC = "0xA0b86991c6218b36c1d19d4a2e9eb0ce3606eb48";

async function connectWallet() {
  if (window.ethereum) {
    provider = new ethers.providers.Web3Provider(window.ethereum);
    await provider.send("eth_requestAccounts", []);
    signer = provider.getSigner();
    userAddress = await signer.getAddress();
    document.getElementById("wallet").innerText = "Connected: " + userAddress;
  } else {
    alert("Install MetaMask");
  }
}

async function getBalance() {
  const balance = await provider.getBalance(userAddress);
  const eth = ethers.utils.formatEther(balance);
  log("ðŸ’° Balance: " + eth + " ETH");
}

function log(msg){
  document.getElementById("output").innerHTML += "<p>"+msg+"</p>";
}

async function swap() {
  const amount = document.getElementById("amount").value;
  if(!amount) return alert("Enter amount");

  const router = new ethers.Contract(
    UNISWAP_ROUTER,
    ["function exactInputSingle(tuple(address,address,uint24,address,uint256,uint256,uint160)) payable returns (uint256)"],
    signer
  );

  const params = {
    tokenIn: ethers.constants.AddressZero,
    tokenOut: USDC,
    fee: 3000,
    recipient: userAddress,
    deadline: Math.floor(Date.now() / 1000) + 60 * 10,
    amountIn: ethers.utils.parseEther(amount),
    amountOutMinimum: 0,
    sqrtPriceLimitX96: 0
  };

  const tx = await router.exactInputSingle(params, { value: ethers.utils.parseEther(amount) });
  log("â›½ Transaction sent...");
  log("Tx Hash: " + tx.hash);
  await tx.wait();
  log("âœ… Swap completed!");
}

function runAI() {
  const input = document.getElementById("aiInput").value.toLowerCase();

  if(input.includes("swap")){
    const words = input.split(" ");
    const amount = words[1];
    document.getElementById("amount").value = amount;
    log("ðŸ¤– AI executing swap...");
    swap();
  } else if(input.includes("balance")){
    getBalance();
  } else {
    log("ðŸ¤– Unknown command.");
  }
}
</script>

</body>
</html>
